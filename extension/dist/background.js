"use strict";(()=>{var n="pelangganpro_auth",a=new Set;chrome.runtime.onConnect.addListener(e=>{if(e.name==="pelangganpro-sidebar"){let o=e.sender?.tab?.id;o&&(a.add(o),console.log("[Background] Content script connected on tab:",o),e.onDisconnect.addListener(()=>{a.delete(o),console.log("[Background] Content script disconnected on tab:",o)}))}});chrome.runtime.onMessage.addListener((e,o,t)=>{if(e.type==="STORE_AUTH")return chrome.storage.local.set({[n]:e.data}).then(()=>{console.log("[Background] Auth stored, notifying tabs..."),r(),t({success:!0})}).catch(c=>t({success:!1,error:c.message})),!0;if(e.type==="GET_AUTH")return chrome.storage.local.get(n).then(c=>t({success:!0,data:c[n]||null})).catch(c=>t({success:!1,error:c.message})),!0;if(e.type==="CLEAR_AUTH")return chrome.storage.local.remove(n).then(()=>{console.log("[Background] Auth cleared, notifying tabs..."),r(),t({success:!0})}).catch(c=>t({success:!1,error:c.message})),!0;if(e.type==="OPEN_POPUP")return chrome.action.openPopup(),!0;if(e.type==="AUTH_CHANGED")return console.log("[Background] Auth change notification received"),r(),t({success:!0}),!0});function r(){console.log("[Background] Notifying tabs about auth change..."),chrome.tabs.query({url:"*://web.whatsapp.com/*"},e=>{e.forEach(o=>{o.id&&(console.log("[Background] Sending refresh to tab:",o.id),chrome.tabs.sendMessage(o.id,{type:"AUTH_REFRESH"}).catch(t=>{console.log("[Background] Could not notify tab",o.id,":",t.message)}))})})}console.log("[Background] Service worker started");})();
